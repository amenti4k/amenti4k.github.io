---
layout: post
title: My Spotify Top Songs
---

## My Top Spotify Songs
---
layout: post
title: My Spotify Top Songs
---

## My Top Spotify Songs

<p>Click the button below to view your top Spotify songs for this year!</p>

<button id="loginButton">Login with Spotify</button>

<div id="topSongs"></div>

<script>
  document.getElementById('loginButton').addEventListener('click', function() {
    // Redirect to Spotify login
    var client_id = '029941bb0f4b47768c899b25819fa09d';
    var redirect_uri = 'https://amenti4k.github.io/2023/08/16/Top-Songs.html'; // Make sure this matches your Jekyll page URL
    var scopes = 'user-top-read'; // Requesting permission to read user's top tracks
    var url = 'https://accounts.spotify.com/authorize?response_type=code&client_id=' + client_id + 
              '&scope=' + encodeURIComponent(scopes) + 
              '&redirect_uri=' + encodeURIComponent(redirect_uri);
    window.location = url;
  });

  // Check for Spotify authorization code in the URL
  var urlParams = new URLSearchParams(window.location.search);
  var code = urlParams.get('code');
  if (code) {
    // You have the authorization code, so you can now request the access token.

    fetch('https://top-albums-7afbbed9dee6.herokuapp.com/exchange', { // Adjust this URL if needed
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ code: code }),
    })
      .then(response => response.json())
      .then(data => {
        // Use the access token to fetch the top songs
        var accessToken = data.access_token;
        fetch('https://api.spotify.com/v1/me/top/tracks?time_range=medium_term', {
          headers: { 'Authorization': 'Bearer ' + accessToken },
        })
          .then(response => response.json())
          .then(data => {
            // Display the top songs
            var topSongsDiv = document.getElementById('topSongs');
            data.items.forEach(track => {
              topSongsDiv.innerHTML += '<p>' + track.name + ' by ' + track.artists[0].name + '</p>';
            });
          });
      });
  }
</script>
